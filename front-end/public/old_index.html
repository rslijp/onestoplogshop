<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>One stop log shop</title>
</head>
<body>
<h1>Hello, world!</h1>
<div class="container">
    <p>Displaying log</p>
    <table id="result">
        <thead>
            <th>at</th>
            <th>level</th>
            <th>message</th>
        </thead>
        <tbody>
            <tr meta="loading">
                <td colspan="3">Loading</td>
            </tr>
        </tbody>
    </table>
    <script type="application/javascript">
        function t(text){
            return document.createTextNode(text);
        }
        function n(type, className, elements){
            const elem = document.createElement(type);
            elem.className = className;
            for(let i=2; i<arguments.length; i++){
                if(!arguments[i]) continue;
                elem.appendChild(arguments[i]);
            }
            return elem;
        }
        function draw(lines){
            const table = document.getElementById("result");
            const body = table.getElementsByTagName("tbody")[0];
            const rows = table.getElementsByTagName("tr");
            const lastRow = rows[rows.length-1];
            if(lastRow && lastRow.attributes.getNamedItem("meta").value === "loading"){
                lastRow.remove();
            }

            for(let i=0;i<lines.length;i++){
                const line = lines[i];
                console.log(line.at);
                body.appendChild(
                    n("tr", "row",
                        n("td", "timestamp", t(line.at)),
                        n("td", "level", t(line.level)),
                        n("td", "message", t(line.message))
                    ))
            }
        }
        async function load() {
            fetch("http://localhost:8080/api/log", {
                method: "GET", // *GET, POST, PUT, DELETE, etc.
                mode: "no-cors", // no-cors, *cors, same-origin
                cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
                credentials: "same-origin", // include, *same-origin, omit
                headers: {
                    "Content-Type": "application/json",
                    // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                redirect: "follow", // manual, *follow, error
                referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                // body: JSON.stringify(data), // body data type must match "Content-Type" header
            }).
            then(r=>r.json()).
            then(r=>draw(r));
        }
        load();
    </script>
</div>
</body>
</html>